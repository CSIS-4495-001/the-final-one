(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1370:function(e,t,s){Promise.resolve().then(s.bind(s,8899))},2209:function(e,t,s){"use strict";s.d(t,{Z:function(){return components_Chat}});var a=s(7437),n=s(2265),r=s(4031),i=s(9213),components_ChatMessage=e=>{let{message:t}=e,s=!1,{user:l}=(0,r._)(),{data:o}=(0,i.Q)(),c=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=c.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let d=new Date(1e3*t.date.seconds);return s=!!l&&t.senderId===l.uid,(0,a.jsxs)("div",{ref:c,className:"flex ".concat(s?"justify-end":"justify-start"," items-center mb-4 ml-2 mr-2"),children:[s&&(0,a.jsx)("p",{className:"text-xs text-gray-400 ml-2 mr-2",children:d.toLocaleString()}),(0,a.jsxs)("div",{className:"max-w-[70%] p-3 rounded-lg ".concat(s?"bg-gray-800 text-white shadow-lg":"bg-gray-400 text-black shadow-lg"," ").concat(s?"float-right":"float-left"),children:[t.text.split("\n").map((e,t)=>(0,a.jsx)("p",{children:e},t)),t.image&&(0,a.jsx)("img",{src:null==t?void 0:t.image,alt:"",className:"mt-2 rounded-md w-full h-auto"})]}),!s&&(0,a.jsx)("p",{className:"text-xs text-gray-500 ml-2 mr-2",children:d.toLocaleString()})]})},l=s(4086),o=s(6085),components_ChatMessages=()=>{let[e,t]=(0,n.useState)([]),{data:s}=(0,i.Q)();return(0,n.useEffect)(()=>{let e=(0,l.cf)((0,l.JU)(o.db,"chats",s.chatId),e=>{e.exists()&&t(e.data().messages)});return()=>{e()}},[s.chatId]),console.log("messages => ",e),(0,a.jsx)("div",{children:e.map(e=>(0,a.jsx)(components_ChatMessage,{message:e},e.id))})},c=s(9584);let{v4:d}=s(4916);var components_ChatInput=()=>{let e=d(),[t,s]=(0,n.useState)(" "),[u,m]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),{user:x}=(0,r._)(),{data:p}=(0,i.Q)(),handleSend=async()=>{if(u){let s=(0,c.iH)(o.tO,"chats/"+e),a=(0,c.B0)(s,u);a.on("state_changed",e=>{},e=>{console.error(e)},()=>{(0,c.Jt)(a.snapshot.ref).then(async s=>{await (0,l.r7)((0,l.JU)(o.db,"chats",p.chatId),{messages:(0,l.vr)({id:e,text:t,senderId:x.uid,date:l.EK.now(),image:s})})})})}else await (0,l.r7)((0,l.JU)(o.db,"chats",p.chatId),{messages:(0,l.vr)({id:e,text:t,senderId:x.uid,date:l.EK.now()})});await (0,l.r7)((0,l.JU)(o.db,"userChats",x.uid),{[p.chatId+".lastMessage"]:{text:t},[p.chatId+".date"]:(0,l.Bt)()}),await (0,l.r7)((0,l.JU)(o.db,"userChats",p.Nuser.uid),{[p.chatId+".lastMessage"]:{text:t},[p.chatId+".date"]:(0,l.Bt)()}),s(""),m(null),g(!1)},handleImageChange=e=>{var t;let s=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;m(s)};return(0,a.jsxs)("div",{className:"bottom-0 left-0 w-full bg-gray-700 flex items-center ",children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter your message...",className:"w-full border border-gray-800 p-4 mr-2 rounded focus:outline-none focus:border-gray-500 text-white bg-gray-800",onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key&&handleSend()},value:t}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("label",{htmlFor:"file",className:"cursor-pointer",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-800 hover:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),(0,a.jsx)("input",{type:"file",style:{display:"none"},id:"file",onChange:e=>{handleImageChange(e),g(!0)}})]}),u&&(0,a.jsx)("div",{className:"mr-2",children:(0,a.jsx)("button",{className:"text-blue-500 underline cursor-pointer",onClick:()=>g(!0)})}),h&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded text-white",children:[(0,a.jsx)("p",{className:"justify-center",children:"Image Selected"}),(0,a.jsx)("button",{className:"bg-blue-500 text-white font-bold py-2 px-4 rounded mr-2",onClick:handleSend,children:"Send"}),(0,a.jsx)("button",{className:"bg-gray-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{m(null),g(!1)},children:"Cancel"})]})}),(0,a.jsx)("div",{className:"bg-gray-800 hover:bg-gray-400 text-white font-bold py-2 px-4 rounded cursor-pointer",onClick:handleSend,children:"Send"})]})};let capitalizeFirstLetter=e=>e.replace(/\b\w/g,e=>e.toUpperCase());var components_Chat=()=>{var e;let{data:t}=(0,i.Q)();console.log("data Latest => ",t);let s=(null===(e=t.Nuser)||void 0===e?void 0:e.displayName)||"",n=s?capitalizeFirstLetter(s):"Chat Window";return(0,a.jsxs)("div",{className:"w-596 overflow-hidden flex flex-col bg-gray-200",style:{height:"43rem"},children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-700",children:[(0,a.jsx)("span",{className:"font-semibold text-lg text-white",children:n}),(0,a.jsx)("hr",{className:"border-t border-white mt-2"})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto bg-gray-700",children:(0,a.jsx)(components_ChatMessages,{})}),(0,a.jsx)(components_ChatInput,{})]})}},4031:function(e,t,s){"use strict";s.d(t,{H:function(){return AuthContextProvider},_:function(){return UserAuth}});var a=s(7437),n=s(2265),r=s(3085),i=s(6085),l=s(4086),o=s(9213);let c=(0,n.createContext)(),AuthContextProvider=e=>{let{children:t}=e,[s,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),handleSendEmailLink=async e=>{let t=(0,r.v0)(),s={url:window.location.origin,handleCodeInApp:!0};try{console.log("dropping mail",s),(0,r.oo)(t,e,s).then(()=>{window.localStorage.setItem("emailForSignIn",e),console.log("Email link sent. Check your email to sign in.")}).catch(e=>{e.code,e.message,console.error("Error sending email link:",e)})}catch(e){console.error("Error sending email link - :",e)}};(0,n.useEffect)(()=>{let e=(0,r.Aj)(i.I8,e=>{d(e)});return e},[s]);let saveUserDetails=async e=>{console.log({user:e}),e.displayName||(e.displayName=e.email.split("@")[0]);let t={displayName:e.displayName.toLowerCase(),email:e.email,uid:e.uid},s=(0,l.JU)(i.db,"users",e.uid),a=(0,l.JU)(i.db,"userChats",e.uid);try{let e=await (0,l.QT)(s);e.exists()?console.log("User document already exists. Skipping creation."):(await (0,l.pl)(s,t),console.log("User document written successfully."));let n=await (0,l.QT)(a);n.exists()?console.log("UserChats document already exists. Skipping creation."):(await (0,l.pl)(a,{}),console.log("UserChats document written successfully."))}catch(e){console.error("Error adding document: ",e)}};return(0,a.jsx)(c.Provider,{value:{user:s,isAdmin:u,setIsAdmin:m,googleSignIn:()=>{let e=new r.hJ;(0,r.rh)(i.I8,e).then(e=>{saveUserDetails(e.user)}).catch(e=>{console.error(e)})},logOut:()=>{(0,r.w7)(i.I8)},handleSendEmailLink,saveUserDetails},children:(0,a.jsx)(o.R,{children:t})})},UserAuth=()=>(0,n.useContext)(c)},9213:function(e,t,s){"use strict";s.d(t,{Q:function(){return ChatAuth},R:function(){return ChatContextProvider}});var a=s(7437),n=s(2265);s(3085),s(6085),s(4086),s(2209);var r=s(4031);let i=(0,n.createContext)(),ChatContextProvider=e=>{let{children:t}=e,{user:s}=(0,r._)(),[l,o]=(0,n.useReducer)((e,t)=>"CHANGE_USER"===t.type?{Nuser:t.payload,chatId:s.uid>t.payload.uid?s.uid+t.payload.uid:t.payload.uid+s.uid}:e,{chatId:"null",Nuser:{}});return(0,a.jsx)(i.Provider,{value:{data:l,dispatch:o},children:t})},ChatAuth=()=>(0,n.useContext)(i)},6085:function(e,t,s){"use strict";s.d(t,{I8:function(){return c},db:function(){return d},tO:function(){return u}});var a=s(3085),n=s(994),r=s(5073),i=s(4086),l=s(9584);let o=(0,n.ZF)({apiKey:"AIzaSyBuAHsQuDml9p5BZpM8qhmUh4r893hXzA8",authDomain:"trademate-ccec1.firebaseapp.com",projectId:"trademate-ccec1",storageBucket:"trademate-ccec1.appspot.com",messagingSenderId:"579948238014",appId:"1:579948238014:web:531bb2e2b28cafe6a2baef",measurementId:"G-ZWJ9YVY5T8"});(0,r.Gb)().then(e=>e?(0,r.IH)(o):null);let c=(0,a.v0)(o),d=(0,i.ad)(o),u=(0,l.cF)(o)},8899:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return RootLayout}});var a=s(7437),n=s(4671),r=s.n(n);s(3054);var i=s(1396),l=s.n(i),o=s(4033),c=s(2265),d=s(4031),u=s(8529),m=s.n(u),h=s(3015),g=s.n(h),x=s(171);s(4193);var p=s(3085),navbar=()=>{let{user:e,googleSignIn:t,logOut:s,handleSendEmailLink:n,saveUserDetails:r,isAdmin:i,setIsAdmin:u}=(0,d._)(),[h,f]=(0,c.useState)(!1),[y,v]=c.useState(!0),[b,j]=(0,c.useState)(!1),[w,N]=(0,c.useState)(""),C=(0,o.useRouter)(),handleSignIn=async()=>{try{await t()}catch(e){console.log(e),f(!0)}},handleEmailVerification=()=>{let e=(0,p.v0)(),t=(0,p.JB)(e,window.location.href);if(t){let t=window.localStorage.getItem("emailForSignIn");t?(0,p.P6)(e,t,window.location.href).then(e=>{console.log("Successfully signed in:",e.user),window.localStorage.removeItem("emailForSignIn"),r(e.user)}).catch(e=>{console.error("Error signing in:",e)}):console.error("Email address not found.")}},openEmailLogin=async()=>{j(!0)},handleEmailLogin=async()=>{if(""!==w.trim())try{console.log({email:w,handleSendEmailLink:n}),await n(w),j(!1),x.Am.success("Email has been sent successfully!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"})}catch(e){console.error("Error sending email link:",e)}},handleSignOut=async()=>{try{await s(),console.log("Logged out, redirecting to home"),C.push("/")}catch(e){console.log(e)}};return(0,c.useEffect)(()=>{let checkAuthentication=async()=>{await new Promise(e=>setTimeout(e,500)),v(!1)};e&&(e&&"xXynFyfXtpbYJrt1mltsCRAfOiX2, Qodiq2Gg9igsPCcGMfvfrvTbJAn1".split(", ").includes(e.uid)?u(!0):u(!1)),checkAuthentication(),handleEmailVerification()},[e,i]),m().setAppElement("#app-root"),(0,a.jsxs)("nav",{className:"relative flex items-center justify-between sm:h-10 md:justify-center py-6 px-4 p-5 bg-gray-700 pt-9 pb-9 pr-9",children:[(0,a.jsx)(x.Ix,{}),(0,a.jsx)("div",{className:"flex items-center flex-1 md:absolute md:inset-y-0 md:left-0",children:(0,a.jsx)("div",{className:"flex items-center justify-between w-full md:w-auto",children:(0,a.jsx)("div",{className:"-mr-2 flex items-center md:hidden",children:(0,a.jsx)("button",{type:"button",id:"main-menu","aria-label":"Main menu","aria-haspopup":"true",className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out",children:(0,a.jsx)("svg",{stroke:"currentColor",fill:"none",viewBox:"0 0 24 24",className:"h-6 w-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})})})})}),e?i?(0,a.jsxs)("div",{className:"hidden md:flex md:space-x-10",children:[(0,a.jsx)(l(),{href:"/admin",className:"font-medium text-white hover:text-gray-900 transition duration-150 ease-in-out",children:"Dashboard"}),(0,a.jsx)(l(),{href:"/admin/moderate",className:"font-medium text-white hover:text-gray-900 transition duration-150 ease-in-out",children:"Moderate"})]}):(0,a.jsxs)("div",{className:"hidden md:flex md:space-x-10",children:[(0,a.jsx)(l(),{href:"/explore",className:"font-medium text-white hover:text-gray-900 transition duration-150 ease-in-out",children:"Explore"}),(0,a.jsx)(l(),{href:"/profile",className:"font-medium text-white hover:text-gray-900 transition duration-150 ease-in-out",children:"Profile"}),(0,a.jsx)(l(),{href:"/chat",className:"font-medium text-white hover:text-gray-900 transition duration-150 ease-in-out",children:"Chat"})]}):(0,a.jsx)("div",{}),(0,a.jsx)("div",{className:"hidden md:absolute md:flex md:items-center md:justify-end md:inset-y-0 md:right-0",children:y?null:e?(0,a.jsx)("div",{className:"flex items-center pr-2",children:(0,a.jsx)("button",{onClick:handleSignOut,className:"bg-red-500 text-white px-4 py-2 rounded cursor-pointer hover:bg-red-600",children:"Sign Out"})}):(0,a.jsxs)("ul",{className:"flex",children:[(0,a.jsx)("li",{onClick:handleSignIn,className:"p-2 cursor-pointer hover:underline",children:(0,a.jsx)("div",{className:"px-6 sm:px-0 max-w-sm",children:(0,a.jsxs)("button",{type:"button",className:"text-white w-full bg-[#4285F4] hover:bg-[#4285F4]/90 focus:ring-4 focus:outline-none focus:ring-[#4285F4]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center justify-between dark:focus:ring-[#4285F4]/55 mr-2 mb-2",children:[(0,a.jsx)("svg",{className:"mr-2 -ml-1 w-4 h-4","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:(0,a.jsx)("path",{fill:"currentColor",d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"})}),"Login with Google",(0,a.jsx)("div",{})]})})}),(0,a.jsx)("li",{className:"p-2 cursor-pointer hover:underline",children:(0,a.jsx)("div",{className:"px-6 sm:px-0 max-w-sm",children:(0,a.jsx)("button",{type:"button",className:"text-white w-full bg-gray-800 hover:bg-gray-700 focus:ring-4 focus:outline-none focus:ring-gray-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center justify-between dark:focus:ring-gray-700 mr-2 mb-2",onClick:openEmailLogin,children:"Login with Email"})})}),h?(0,a.jsx)("p",{className:"text-red-500",children:"Error signing in"}):null]})}),(0,a.jsx)(m(),{isOpen:b,onRequestClose:()=>j(!1),contentLabel:"Enter Email Modal",className:g().modal,shouldCloseOnOverlayClick:!0,style:{overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(19, 19, 19, 0.75)"}},children:(0,a.jsxs)("div",{className:g().emailModal,children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Enter Your Email"}),(0,a.jsx)("input",{type:"email",placeholder:"Please enter your email",value:w,onChange:e=>N(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 mb-4 w-full"}),(0,a.jsx)("button",{onClick:handleEmailLogin,className:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",children:"Send Email Link"})]})})]})};function RootLayout(e){let{children:t}=e;return(0,a.jsxs)("html",{lang:"en",children:[(0,a.jsx)("head",{children:(0,a.jsx)("title",{children:"TradeMate - A project by Gaurav and Anshdeep"})}),(0,a.jsxs)("body",{className:r().className,children:[(0,a.jsx)("div",{id:"app-root",children:(0,a.jsxs)(d.H,{children:[(0,a.jsx)(navbar,{}),t]})}),(0,a.jsx)("script",{async:!0,src:"/js/static.js"}),(0,a.jsx)("script",{async:!0,src:"https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyClGrRrDVhzjZKtCfww9Y85AhJHeDaYzsA","&libraries=places&callback=initMap")})]})]})}},3054:function(){},3015:function(e){e.exports={modal:"navbar_modal__LLVRE",overlay:"navbar_overlay__y_v0F",emailModal:"navbar_emailModal__CFyR5"}}},function(e){e.O(0,[358,214,564,363,971,864,744],function(){return e(e.s=1370)}),_N_E=e.O()}]);