(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{363:function(e,t,s){Promise.resolve().then(s.bind(s,8693))},8693:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return chat_page}});var a=s(7437),n=s(2265),r=s(4033),l=s(4031),components_ChatNavbar=()=>(0,a.jsx)("div",{className:"bg-gray-800 p-4 text-white rounded-t-lg",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Chats"})}),i=s(4086),o=s(6085),d=s(9213),components_Chats=()=>{let[e,t]=n.useState({}),{user:s}=(0,l._)(),{dispatch:r}=(0,d.Q)();(0,n.useEffect)(()=>{console.log("user => ",s),s&&(()=>{let e=(0,i.JU)(o.db,"userChats",s.uid);t({}),(0,i.QT)(e).then(s=>{s.exists()&&(console.log("Document already exists:",s.data()),t(s.data()));let a=(0,i.cf)(e,e=>{t(e.data()),console.log("chats => ",e.data())});return()=>{a()}}).catch(e=>{console.error("Error checking document:",e)})})()},[s]);let capitalizeFirstLetter=e=>e.replace(/\b\w/g,e=>e.toUpperCase()),handleSelect=async e=>{console.log("handleSelect => ",e),r({type:"CHANGE_USER",payload:e})};return(0,a.jsx)(a.Fragment,{children:e?Object.entries(e).map(e=>{var t;let[s,n]=e;return(0,a.jsx)("div",{className:"flex items-center p-3 hover:bg-gray-700 cursor-pointer shadow-md text-white bg-gray-800",onClick:()=>handleSelect(n.userInfo),children:(0,a.jsxs)("div",{className:"flex items-center justify-center mt-4 hover:bg-gray-700 cursor-pointer",children:[(0,a.jsxs)("div",{className:"bg-blue-500 text-white rounded-full h-12 w-12 flex items-center justify-center text-lg font-bold",children:[(0,a.jsx)("span",{children:n.userInfo.displayName[0].toUpperCase()}),n.userInfo.displayName.includes(" ")&&(0,a.jsx)("span",{children:n.userInfo.displayName.split(" ")[1][0].toUpperCase()})]}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("div",{children:capitalizeFirstLetter(n.userInfo.displayName)}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:null===(t=n.lastMessage)||void 0===t?void 0:t.text})]})]})},s)}):"Loading..."})},components_ChatSearch=()=>{let[e,t]=n.useState(""),[s,r]=n.useState(null),[d,c]=n.useState(!1),{user:u}=(0,l._)(),handleSelect=async()=>{if(s){let e=u.uid>s.uid?u.uid+s.uid:s.uid+u.uid;console.log("combineId => ",e);try{let t=await (0,i.QT)((0,i.JU)(o.db,"chats",e));t.exists()||(await (0,i.pl)((0,i.JU)(o.db,"chats",e),{messages:[]}),await (0,i.r7)((0,i.JU)(o.db,"userChats",u.uid),{[e+".userInfo"]:{uid:s.uid,displayName:s.displayName},[e+".date"]:(0,i.Bt)()}),await (0,i.r7)((0,i.JU)(o.db,"userChats",s.uid),{[e+".userInfo"]:{uid:u.uid,displayName:u.displayName},[e+".date"]:(0,i.Bt)()}),console.log("user connection created"))}catch(e){console.log(e)}}r(null),t("")};return(0,a.jsxs)("div",{className:"text-center",children:[d&&(0,a.jsx)("p",{className:"text-red-500 text-lg font-bold",children:"User not found"}),s&&(0,a.jsxs)("div",{className:"flex items-center justify-center mt-4 hover:bg-gray-700 cursor-pointer rounded-md p-2 transition-colors duration-200 text-white",onClick:handleSelect,children:[(0,a.jsxs)("div",{className:"bg-blue-500 text-white rounded-full h-12 w-12 flex items-center justify-center text-lg font-bold",children:[(0,a.jsx)("span",{children:s.displayName[0].toUpperCase()}),s.displayName.includes(" ")&&(0,a.jsx)("span",{children:s.displayName.split(" ")[1][0].toUpperCase()})]}),(0,a.jsx)("div",{className:"ml-2 text-lg font-semibold",children:s.displayName})]})]})},components_ChatSidebar=()=>(0,a.jsxs)("div",{children:[(0,a.jsx)(components_ChatNavbar,{}),(0,a.jsx)(components_ChatSearch,{}),(0,a.jsx)(components_Chats,{})]}),c=s(2209),chat_page=()=>{let{user:e}=(0,l._)(),t=(0,r.useRouter)();return(0,n.useEffect)(()=>{e||t.push("/")}),(0,a.jsxs)("div",{className:"flex p-4 bg-gray-700 text-white",children:[(0,a.jsx)("div",{className:"w-1/4 pr-4 p-2",children:(0,a.jsx)(components_ChatSidebar,{})}),(0,a.jsx)("div",{className:"w-3/4",children:(0,a.jsx)("div",{className:"bg-gray-700 p-1 rounded-lg shadow text-white",style:{height:"calc(100vh - 102px)"},children:(0,a.jsx)(c.Z,{})})})]})}},2209:function(e,t,s){"use strict";s.d(t,{Z:function(){return components_Chat}});var a=s(7437),n=s(2265),r=s(4031),l=s(9213),components_ChatMessage=e=>{let{message:t}=e,s=!1,{user:i}=(0,r._)(),{data:o}=(0,l.Q)(),d=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let c=new Date(1e3*t.date.seconds);return s=!!i&&t.senderId===i.uid,(0,a.jsxs)("div",{ref:d,className:"flex ".concat(s?"justify-end":"justify-start"," items-center mb-4 ml-2 mr-2"),children:[s&&(0,a.jsx)("p",{className:"text-xs text-gray-400 ml-2 mr-2",children:c.toLocaleString()}),(0,a.jsxs)("div",{className:"max-w-[70%] p-3 rounded-lg ".concat(s?"bg-gray-800 text-white shadow-lg":"bg-gray-400 text-black shadow-lg"," ").concat(s?"float-right":"float-left"),children:[t.text.split("\n").map((e,t)=>(0,a.jsx)("p",{children:e},t)),t.image&&(0,a.jsx)("img",{src:null==t?void 0:t.image,alt:"",className:"mt-2 rounded-md w-full h-auto"})]}),!s&&(0,a.jsx)("p",{className:"text-xs text-gray-500 ml-2 mr-2",children:c.toLocaleString()})]})},i=s(4086),o=s(6085),components_ChatMessages=()=>{let[e,t]=(0,n.useState)([]),{data:s}=(0,l.Q)();return(0,n.useEffect)(()=>{let e=(0,i.cf)((0,i.JU)(o.db,"chats",s.chatId),e=>{e.exists()&&t(e.data().messages)});return()=>{e()}},[s.chatId]),console.log("messages => ",e),(0,a.jsx)("div",{children:e.map(e=>(0,a.jsx)(components_ChatMessage,{message:e},e.id))})},d=s(9584);let{v4:c}=s(4916);var components_ChatInput=()=>{let e=c(),[t,s]=(0,n.useState)(" "),[u,h]=(0,n.useState)(null),[m,p]=(0,n.useState)(!1),{user:g}=(0,r._)(),{data:x}=(0,l.Q)(),handleSend=async()=>{if(u){let s=(0,d.iH)(o.tO,"chats/"+e),a=(0,d.B0)(s,u);a.on("state_changed",e=>{},e=>{console.error(e)},()=>{(0,d.Jt)(a.snapshot.ref).then(async s=>{await (0,i.r7)((0,i.JU)(o.db,"chats",x.chatId),{messages:(0,i.vr)({id:e,text:t,senderId:g.uid,date:i.EK.now(),image:s})})})})}else await (0,i.r7)((0,i.JU)(o.db,"chats",x.chatId),{messages:(0,i.vr)({id:e,text:t,senderId:g.uid,date:i.EK.now()})});await (0,i.r7)((0,i.JU)(o.db,"userChats",g.uid),{[x.chatId+".lastMessage"]:{text:t},[x.chatId+".date"]:(0,i.Bt)()}),await (0,i.r7)((0,i.JU)(o.db,"userChats",x.Nuser.uid),{[x.chatId+".lastMessage"]:{text:t},[x.chatId+".date"]:(0,i.Bt)()}),s(""),h(null),p(!1)},handleImageChange=e=>{var t;let s=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;h(s)};return(0,a.jsxs)("div",{className:"bottom-0 left-0 w-full bg-gray-700 flex items-center ",children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter your message...",className:"w-full border border-gray-800 p-4 mr-2 rounded focus:outline-none focus:border-gray-500 text-white bg-gray-800",onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key&&handleSend()},value:t}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("label",{htmlFor:"file",className:"cursor-pointer",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-800 hover:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),(0,a.jsx)("input",{type:"file",style:{display:"none"},id:"file",onChange:e=>{handleImageChange(e),p(!0)}})]}),u&&(0,a.jsx)("div",{className:"mr-2",children:(0,a.jsx)("button",{className:"text-blue-500 underline cursor-pointer",onClick:()=>p(!0)})}),m&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded text-white",children:[(0,a.jsx)("p",{className:"justify-center",children:"Image Selected"}),(0,a.jsx)("button",{className:"bg-blue-500 text-white font-bold py-2 px-4 rounded mr-2",onClick:handleSend,children:"Send"}),(0,a.jsx)("button",{className:"bg-gray-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{h(null),p(!1)},children:"Cancel"})]})}),(0,a.jsx)("div",{className:"bg-gray-800 hover:bg-gray-400 text-white font-bold py-2 px-4 rounded cursor-pointer",onClick:handleSend,children:"Send"})]})};let capitalizeFirstLetter=e=>e.replace(/\b\w/g,e=>e.toUpperCase());var components_Chat=()=>{var e;let{data:t}=(0,l.Q)();console.log("data Latest => ",t);let s=(null===(e=t.Nuser)||void 0===e?void 0:e.displayName)||"",n=s?capitalizeFirstLetter(s):"Chat Window";return(0,a.jsxs)("div",{className:"w-596 overflow-hidden flex flex-col bg-gray-200",style:{height:"43rem"},children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-700",children:[(0,a.jsx)("span",{className:"font-semibold text-lg text-white",children:n}),(0,a.jsx)("hr",{className:"border-t border-white mt-2"})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto bg-gray-700",children:(0,a.jsx)(components_ChatMessages,{})}),(0,a.jsx)(components_ChatInput,{})]})}},4031:function(e,t,s){"use strict";s.d(t,{H:function(){return AuthContextProvider},_:function(){return UserAuth}});var a=s(7437),n=s(2265),r=s(3085),l=s(6085),i=s(4086),o=s(9213);let d=(0,n.createContext)(),AuthContextProvider=e=>{let{children:t}=e,[s,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),handleSendEmailLink=async e=>{let t=(0,r.v0)(),s={url:window.location.origin,handleCodeInApp:!0};try{console.log("dropping mail",s),(0,r.oo)(t,e,s).then(()=>{window.localStorage.setItem("emailForSignIn",e),console.log("Email link sent. Check your email to sign in.")}).catch(e=>{e.code,e.message,console.error("Error sending email link:",e)})}catch(e){console.error("Error sending email link - :",e)}};(0,n.useEffect)(()=>{let e=(0,r.Aj)(l.I8,e=>{c(e)});return e},[s]);let saveUserDetails=async e=>{console.log({user:e}),e.displayName||(e.displayName=e.email.split("@")[0]);let t={displayName:e.displayName.toLowerCase(),email:e.email,uid:e.uid},s=(0,i.JU)(l.db,"users",e.uid),a=(0,i.JU)(l.db,"userChats",e.uid);try{let e=await (0,i.QT)(s);e.exists()?console.log("User document already exists. Skipping creation."):(await (0,i.pl)(s,t),console.log("User document written successfully."));let n=await (0,i.QT)(a);n.exists()?console.log("UserChats document already exists. Skipping creation."):(await (0,i.pl)(a,{}),console.log("UserChats document written successfully."))}catch(e){console.error("Error adding document: ",e)}};return(0,a.jsx)(d.Provider,{value:{user:s,isAdmin:u,setIsAdmin:h,googleSignIn:()=>{let e=new r.hJ;(0,r.rh)(l.I8,e).then(e=>{saveUserDetails(e.user)}).catch(e=>{console.error(e)})},logOut:()=>{(0,r.w7)(l.I8)},handleSendEmailLink,saveUserDetails},children:(0,a.jsx)(o.R,{children:t})})},UserAuth=()=>(0,n.useContext)(d)},9213:function(e,t,s){"use strict";s.d(t,{Q:function(){return ChatAuth},R:function(){return ChatContextProvider}});var a=s(7437),n=s(2265);s(3085),s(6085),s(4086),s(2209);var r=s(4031);let l=(0,n.createContext)(),ChatContextProvider=e=>{let{children:t}=e,{user:s}=(0,r._)(),[i,o]=(0,n.useReducer)((e,t)=>"CHANGE_USER"===t.type?{Nuser:t.payload,chatId:s.uid>t.payload.uid?s.uid+t.payload.uid:t.payload.uid+s.uid}:e,{chatId:"null",Nuser:{}});return(0,a.jsx)(l.Provider,{value:{data:i,dispatch:o},children:t})},ChatAuth=()=>(0,n.useContext)(l)},6085:function(e,t,s){"use strict";s.d(t,{I8:function(){return d},db:function(){return c},tO:function(){return u}});var a=s(3085),n=s(994),r=s(5073),l=s(4086),i=s(9584);let o=(0,n.ZF)({apiKey:"AIzaSyBuAHsQuDml9p5BZpM8qhmUh4r893hXzA8",authDomain:"trademate-ccec1.firebaseapp.com",projectId:"trademate-ccec1",storageBucket:"trademate-ccec1.appspot.com",messagingSenderId:"579948238014",appId:"1:579948238014:web:531bb2e2b28cafe6a2baef",measurementId:"G-ZWJ9YVY5T8"});(0,r.Gb)().then(e=>e?(0,r.IH)(o):null);let d=(0,a.v0)(o),c=(0,l.ad)(o),u=(0,i.cF)(o)},4033:function(e,t,s){e.exports=s(290)}},function(e){e.O(0,[358,214,564,971,864,744],function(){return e(e.s=363)}),_N_E=e.O()}]);